import requests
import re

# 1. å®šä¹‰å®˜æ–¹æºåœ°å€
url = "https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Full_MultiMode.ini"

# 2. ä¸‹è½½æ–‡ä»¶
print("æ­£åœ¨ä¸‹è½½å®˜æ–¹é…ç½®...")
r = requests.get(url)
if r.status_code != 200:
    print("ä¸‹è½½å¤±è´¥")
    exit(1)
content = r.text

print("ä¸‹è½½æˆåŠŸï¼Œå¼€å§‹ä¿®æ”¹é…ç½®...")

# ===============================================================
# 3. å®šä¹‰ä½ è¦æ·»åŠ çš„ 3 ä¸ªæ–°ç­–ç•¥ç»„
#    æ ¼å¼è¯´æ˜ï¼šcustom_proxy_group=ç»„å`ç±»å‹`ç­›é€‰æ¡ä»¶`æµ‹é€Ÿåœ°å€`é—´éš”,,å®¹å·®
# ===============================================================

# è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼šå…ˆå®šä¹‰å­—ç¬¦ä¸²ï¼Œåé¢æ’å…¥åˆ°æ–‡ä»¶ä¸­
new_groups_def = """
; === è‡ªå®šä¹‰æ–°å¢ç­–ç•¥ç»„ Start ===
custom_proxy_group=è‡ªå®šä¹‰é¦™æ¸¯é«˜çº§BGPè´Ÿè½½å‡è¡¡`load-balance`(é¦™æ¸¯ é«˜çº§ä¸­ç»§)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=è‡ªå®šä¹‰é¦™æ¸¯IEPLè´Ÿè½½å‡è¡¡`load-balance`(é¦™æ¸¯ IEPL)`http://www.gstatic.com/generate_204`300,,50
custom_proxy_group=è‡ªå®šä¹‰æ—¥å¸¸å·¥ä½œ`url-test`[]è‡ªå®šä¹‰é¦™æ¸¯é«˜çº§BGPè´Ÿè½½å‡è¡¡`[]è‡ªå®šä¹‰é¦™æ¸¯IEPLè´Ÿè½½å‡è¡¡`[]â™»ï¸ è‡ªåŠ¨é€‰æ‹©`http://www.gstatic.com/generate_204`300,,50
; === è‡ªå®šä¹‰æ–°å¢ç­–ç•¥ç»„ End ===
"""

# ===============================================================
# 4. æ‰§è¡Œè‡ªåŠ¨åŒ–ä¿®æ”¹é€»è¾‘
# ===============================================================

# ã€ä¿®æ”¹æ“ä½œ Aã€‘æ’å…¥æ–°ç­–ç•¥ç»„å®šä¹‰
# æˆ‘ä»¬æŠŠæ–°å®šä¹‰çš„ç»„ï¼Œæ’å…¥åˆ° ";è®¾ç½®åˆ†ç»„æ ‡å¿—ä½" è¿™ä¸€è¡Œçš„åé¢ï¼Œè¿™æ ·å®ƒä»¬å°±ç”Ÿæ•ˆäº†
if ";è®¾ç½®åˆ†ç»„æ ‡å¿—ä½" in content:
    content = content.replace(";è®¾ç½®åˆ†ç»„æ ‡å¿—ä½", ";è®¾ç½®åˆ†ç»„æ ‡å¿—ä½\n" + new_groups_def)
else:
    # å¦‚æœæ‰¾ä¸åˆ°æ ‡å¿—ä½ï¼Œå°±åŠ åœ¨ [custom] åé¢
    content = content.replace("[custom]", "[custom]\n" + new_groups_def)
print("âœ… å·²åˆ›å»º 3 ä¸ªè‡ªå®šä¹‰ç­–ç•¥ç»„")


# ã€ä¿®æ”¹æ“ä½œ Bã€‘ä¿®æ”¹ "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
# ç›®æ ‡ï¼šæŠŠ "è‡ªå®šä¹‰æ—¥å¸¸å·¥ä½œ" æ’åœ¨ "select`" çš„åé¢ï¼Œä½œä¸ºç¬¬ä¸€ä¸ªé€‰é¡¹
# åŸæ–‡ç±»ä¼¼ï¼šcustom_proxy_group=ğŸš€ èŠ‚ç‚¹é€‰æ‹©`select`[]â™»ï¸ è‡ªåŠ¨é€‰æ‹©`...
# æˆ‘ä»¬æŸ¥æ‰¾ï¼šcustom_proxy_group=ğŸš€ èŠ‚ç‚¹é€‰æ‹©`select`
# æ›¿æ¢ä¸ºï¼šcustom_proxy_group=ğŸš€ èŠ‚ç‚¹é€‰æ‹©`select`[]è‡ªå®šä¹‰æ—¥å¸¸å·¥ä½œ`
content = content.replace(
    "custom_proxy_group=ğŸš€ èŠ‚ç‚¹é€‰æ‹©`select`", 
    "custom_proxy_group=ğŸš€ èŠ‚ç‚¹é€‰æ‹©`select`[]è‡ªå®šä¹‰æ—¥å¸¸å·¥ä½œ`"
)
print("âœ… å·²å°† [è‡ªå®šä¹‰æ—¥å¸¸å·¥ä½œ] åŠ å…¥åˆ°èŠ‚ç‚¹é€‰æ‹©é¦–ä½")


# ã€ä¿®æ”¹æ“ä½œ Cã€‘é‡å†™ "ğŸ’¬ Aiå¹³å°"
# ç›®æ ‡ï¼šåªè¦åŒ…å« GPTã€Geminiã€Ai çš„èŠ‚ç‚¹
# æˆ‘ä»¬ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ‰¾åˆ°ä»¥ "custom_proxy_group=ğŸ’¬ Aiå¹³å°" å¼€å¤´çš„æ•´è¡Œï¼Œç›´æ¥æ›¿æ¢æ‰
# è¿™é‡Œçš„ (GPT|Gemini|Ai) å°±æ˜¯ç”±äºä½ éœ€è¦åŒ¹é…è¿™ä¸‰ä¸ªå…³é”®å­—
new_ai_group = "custom_proxy_group=ğŸ’¬ Aiå¹³å°`select`(GPT|Gemini|Ai)"

# re.sub(æ­£åˆ™è¡¨è¾¾å¼, æ›¿æ¢å†…å®¹, åŸæ–‡)
# ^custom_proxy_group=ğŸ’¬ Aiå¹³å°.* ä»£è¡¨ä»è¿™å¥å¼€å¤´åŒ¹é…åˆ°è¡Œå°¾
content = re.sub(
    r"^custom_proxy_group=ğŸ’¬ Aiå¹³å°.*", 
    new_ai_group, 
    content, 
    flags=re.MULTILINE
)
print("âœ… å·²ä¿®æ”¹ [ğŸ’¬ Aiå¹³å°] ä¸ºä»…ç­›é€‰ GPT/Gemini/Ai")


# ===============================================================
# 5. ä¿å­˜ä¸ºæ–°æ–‡ä»¶
# ===============================================================
filename = "ACL4SSR_Custom.ini"
with open(filename, "w", encoding="utf-8") as f:
    f.write(content)

print(f"ğŸ‰ æˆåŠŸæ›´æ–°å¹¶ä¿å­˜ä¸º {filename}")
